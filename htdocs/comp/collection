</%perl>
<%args>
	$userId => undef
	$collectionId => undef
	$dbh => undef
	$rodbh => undef
	$rawdbh => undef
</%args>


<& /comp/tablebegin, title => "Music in collection" &>


<%perl>

my $sql = Sql->new($dbh);

# Get all releases in collection
use MusicBrainz::Server::CollectionInfo;
my $collectionInfo = MusicBrainz::Server::CollectionInfo->new($session{uid}, $rodbh, $rawdbh, undef);
my $releases = $collectionInfo->GetHasMBIDs();
my $count = @$releases;

if($count == 0) # Check if there are releases to display
{
	print 'No releases in collection.';
}
else
{
	my $rownum=0;
</%perl>


<table id="CompactReleaseList">
	<col style="text-align: right" />
	<col style="text-align: right" />
	<col style="text-align: right" />
	<col style="text-align: center" />
	<col style="text-align: center" />
	<col style="text-align: center" />
	<col />
	
	
	<tr>
		<td><b>Artist</b></td>
		<td><b>Release name</b></td>
		<td><b>Release date</b></td>
		<td><b>Track count</b></td>
	</tr>


<%perl>


use MusicBrainz::Server::Release;

$collectionInfo->GetHasMBIDsForArtist('357465');

for my $mbid (@{$releases})
{
	# load Release object
	my $release = MusicBrainz::Server::Release->new($dbh);
	$release->SetMBId(@{$mbid}[0]);
	$release->LoadFromId();
	
	my $artistname = $sql->SelectSingleValue("SELECT name FROM artist WHERE id='" . $release->GetArtist() . "'");
	
	
	print '<tr class="'.('ev', 'od')[$rownum % 2].'">';
	print '<td>'. $artistname .'</td>';
	print '<td>'. $release->GetName() .'</td>';
	print '<td>'. $release->GetFirstReleaseDate() .'</td>';
	print '<td>'. $release->GetTrackCount() .'</td>';
	print '</tr>';

	$rownum++;
}


print '</table>';


}



</%perl>


<& /comp/tableend &>