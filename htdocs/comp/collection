</%perl>
<%args>
	$userId => undef
	$collectionId => undef
	$dbh => undef
	$rodbh => undef
	$rawdbh => undef
</%args>


<& /comp/tablebegin, title => "Music in collection" &>

<%perl>

my $sql = Sql->new($dbh);

# Get all releases in collection
use MusicBrainz::Server::CollectionInfo;
my $collectionInfo = MusicBrainz::Server::CollectionInfo->new($session{uid}, $rodbh, $rawdbh, undef);
my $releases = $collectionInfo->GetHasMBIDs();
my $count = @$releases;

if($count == 0) # Check if there are releases to display
{
	print '<p>You have no releases in your collection. To add a release, view any release in MusicBrainz' .
	      ' and click on the <i>Add release to collection</i> link.</p>'
}
else
{
	my $rownum=0;
</%perl>


<table id="CompactReleaseList">
	<col style="text-align: right" />
	<col style="text-align: right" />
	<col style="text-align: right" />
	<col style="text-align: center" />
	<col style="text-align: center" />
	<col style="text-align: center" />
	<col />
	
	
	<tr>
		<td><b>Artist</b></td>
		<td><b>Release name</b></td>
		<td><b>Release date</b></td>
		<td><b>Track count</b></td>
	</tr>


<%perl>


use MusicBrainz::Server::Release;


for my $mbid (@{$releases})
{
	# load Release object

        
	my $release = MusicBrainz::Server::Release->new($dbh);
	$release->SetMBId(@{$mbid}[0]);
	$release->LoadFromId();

	my $artist = MusicBrainz::Server::Artist->new($dbh);
	$artist->SetId($release->GetArtist());
	$artist->LoadFromId();
	
	print '<tr class="'.('ev', 'od')[$rownum % 2].'">';
	print '<td><a href="/artist/'.$artist->GetMBId.'.html">'.$artist->GetName().'</a></td>';
	print '<td><a href="/release/'.$release->GetMBId.'.html">'. $release->GetName() .'</a></td>';
	
	# why do this following commented line print the release date further up in the document?
	#print '<td>'. $m->comp('/comp/releasedate', $release->GetFirstReleaseDateYMD) .'</td>';
</%perl>
	<td><& /comp/releasedate, $release->GetFirstReleaseDateYMD &></td>
<%perl>
	print '<td>'. $release->GetTrackCount() .'</td>';
	print '</tr>';

	$rownum++;
}


print '</table>';


}



</%perl>


<& /comp/tableend &>
