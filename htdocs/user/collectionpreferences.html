<script src="/scripts/jsselect.js" type="text/javascript"></script>
<script src="/scripts/rellinks.js" type="text/javascript"></script>

<%perl>


	# Set up page
	my $mbro = $m->comp("/comp/dblogin");
	$m->comp("/comp/sidebar-notitle", pagetitle => 'Collection Preferences');
	
	# Make sure user is logged on
	$m->comp("/comp/checkloggedin", 1, 1, "You need to be logged in to modify your collection preferences.", 1) or return;
	
	# Log on to raw database
	require MusicBrainz;
	my $mbraw = MusicBrainz->new();
	$mbraw->Login(db => 'RAWDATA');
	
	# make sure the user has a collection_info tuple
	MusicBrainz::Server::CollectionInfo::AssureCollection($session{uid}, $mbraw->{DBH});
	
	require MusicBrainz::Server::CollectionPreference;
	my $preferences = MusicBrainz::Server::CollectionPreference->new($mbro->{DBH}, $mbraw->{DBH}, $session{uid});
	
	if($r->method eq 'POST')
	{
		for my $key ($preferences->valid_keys())
		{
			my $value = $ARGS{$key};
			
			
			# convert the value from "on" or empty to a boolean value
			if($value eq 'on')
			{
				$value = 1;
			}
			elsif($value eq '')
			{
				$value = 0;
			}
			
			
			$preferences->set($key, $value);
		}
	}
	
	
	
	
	
	
	my %releaseTypes = (
	    0 => [ "ignore_nonalbumtracks", "Non-Album Track", "Non-Album Tracks", "(Special case)"],
	    1 => [ "ignore_album", "Album", "Albums", "An album release primarily consists of previously unreleased material. This includes album re-issues, with or without bonus tracks."],
	    2 => [ "ignore_single", "Single", "Singles", "A single typically has one main song and possibly a handful of additional tracks or remixes of the main track. A single is usually named after its main song."],
	    3 => [ "ignore_ep", "EP", "EPs", "An EP is an Extended Play release and often contains the letters EP in the title."],
	    4 => [ "ignore_compilation", "Compilation", "Compilations", "A compilation is a collection of previously released tracks by one or more artists."],
	    5 => [ "ignore_soundtrack", "Soundtrack", "Soundtracks", "A soundtrack is the musical score to a movie, TV series, stage show, computer game etc."],
	    6 => [ "ignore_spokenword", "Spokenword", "Spokenword", "Non-music spoken word releases."],
	    7 => [ "ignore_interview", "Interview", "Interviews", "An interview release contains an interview with the Artist."],
	    8 => [ "ignore_audiobook", "Audiobook", "Audiobooks", "An audiobook is a book read by a narrator without music."],
	    9 => [ "ignore_live", "Live", "Live Releases", "A release that was recorded live."],
	    10 => [ "ignore_remix", "Remix", "Remixes", "A release that was (re)mixed from previously released material."],
	    11 => [ "ignore_other", "Other", "Other Releases", "Any release that does not fit any of the categories above."],
	
	    100 => [ "ignore_official", "Official", "Official", "Any release officially sanctioned by the artist and/or their record company. (Most releases will fit into this category.)"],
	    101 => [ "ignore_promotion", "Promotion", "Promotions", "A giveaway release or a release intended to promote an upcoming official release. (e.g. prerelease albums or releases included with a magazine)"],
	    102 => [ "ignore_bootleg", "Bootleg", "Bootlegs", "An unofficial/underground release that was not sanctioned by the artist and/or the record company."],
	    103 => [ "ignore_pseudorelease", "Pseudo-Release", "PseudoReleases", "A pseudo-release is a duplicate release for translation/transliteration purposes."]
	);



</%perl>


<form method="post" action="/user/collectionpreferences.html" id="CollectionPreferencesForm">
	<& /comp/tablebegin, title => "New releases" &>
		<div>
			How far in advance would you like to be notified about upcoming releases?
			<select name="notificationinterval">
				<& /comp/options,
					[
						[ 1, "A day" ],
						[ 7, "A week" ],
						[ 14, "Two weeks" ],
						[ 31, "A month" ],
					],
					$preferences->get('notificationinterval') &>
			</select>
		</div>
		
		<div>
			<input type="checkbox" name="emailnotifications" id="pref_emailnotifications"
%				$m->out($preferences->get('emailnotifications')==1 ? ' checked="checked" ' : "" );
				/>
			<label for="pref_vote_abs_default">
				E-mail notifications about upcoming releases.</label>
		</div>
		
		
%		for my $key (keys %releaseTypes)
%		{
			<div>
				<input type="checkbox" name="emailnotifications" id="pref_emailnotifications"
%				$m->out($preferences->get('emailnotifications')==1 ? ' checked="checked" ' : '' );
					/>
				<label for="pref_vote_abs_default">
				</label>
			</div>
%		}
	<& /comp/tableend &>
	
	<& /comp/tablebegin, title => "Ignore release types" &>
	
	<& /comp/tableend &>

	<input type="submit" value="Update &raquo;" />
	
</form>